<%- include("partials/header"); -%>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
<script src="/scripts/graph.js"></script>

<h1>Inflation Expense Projection</h1>

<div class="vertical-spacing"></div>

<canvas id="myChart" style="width:100%;max-width:1000px"></canvas>

<script>
  
  //define current date
  const currentDate = new Date;
  const currentYear = currentDate.getFullYear();

  
  //data to be pulled from userData table
  const userInflationRate = 0.067;
  const userSalaryIncreaseRate = 0.066;
  const startMonthlyIncome = 800;
  const startMonthlyExpenditure = 500;
  const beginYear = 2023;

  //years passed since user made their plan
  const yearsPassed = currentYear - beginYear;
  
  const currentIncome = startMonthlyIncome * (1+userSalaryIncreaseRate)**yearsPassed;
  const currentExpenditure = startMonthlyExpenditure * (1+userSalaryIncreaseRate)**yearsPassed;

  const five_year_income = [currentIncome * 12, currentIncome * 12, currentIncome * 12, currentIncome * 12, currentIncome * 12];
  const userExpenses = [currentExpenditure * 12, currentExpenditure * 12, currentExpenditure * 12, currentExpenditure * 12, currentExpenditure * 12];
  const compoundedExpenses = [...userExpenses]; // Make a copy of userExpenses array


  plotIncomeExpensesGraph(five_year_income, userExpenses, userInflationRate, userSalaryIncreaseRate);
</script>

<h2 color="red">Breakdown of projected expenses</h2>

<% 
const expenseByVendor = [
  {
    sectionTitle: "Annual expense Projection",
    expenses: [{ name: "Amount spent this year", amount: 15000.14 }],
    currentYear: new Date().getFullYear(),
    inflation: 0.06,
  },
  {
    sectionTitle: "Food",
    expenses: [
      { name: "Mcdonalds", amount: 107.14 },
      { name: "KFC", amount: 57.34 },
      { name: "Food Court", amount: 73.43 },
    ],
    currentYear: new Date().getFullYear(),
    inflation: 0.06,
  },
  {
    sectionTitle: "Utilities",
    expenses: [
      { name: "Electricity Bill", amount: 31.90 },
      { name: "Water Bill", amount: 30.89 },
      { name: "Public Transport", amount: 77.78 },
    ],
    currentYear: new Date().getFullYear(),
    inflation: 0.06,
  },
  {
    sectionTitle: "Entertainment",
    expenses: [
      { name: "Netflix", amount: 107.14 },
      { name: "Disney Plus", amount: 57.34 },
      { name: "Amazon Primevideo", amount: 73.43 },
    ],
    currentYear: new Date().getFullYear(),
    inflation: 0.06,
  },
];
%>

<% expenseByVendor.forEach((category) => { %>
  <div class="expense-card">
    <div class="card">
      <h4><%= category.sectionTitle %></h4>
      <table class="table">
        <thead>
          <tr>
            <th>Expense Item</th>
            <% for (let i = 0; i < 5; i++) { %>
              <th><%= category.currentYear + i %></th>
            <% } %>
          </tr>
        </thead>
        <tbody>
          <% category.expenses.forEach((item) => { %>
            <tr>
              <td><%= item.name %></td>
              <% for (let i = 0; i < 5; i++) { %>
                <td>
                  $<%= (item.amount * Math.pow(1 + category.inflation, i)).toFixed(2) %>
                  <% if (i > 0) { %> <!-- Adding the '+' for subsequent years -->
                    <br>
                    <span class="plus-amount">+$<%= ((item.amount * Math.pow(1 + category.inflation, i)) - (item.amount * Math.pow(1 + category.inflation, i - 1))).toFixed(2) %></span>
                  <% } %>
                </td>
              <% } %>
            </tr>
          <% }); %>
        </tbody>
      </table>
      <p> <span style="color: red"> Red font represents annual increase in expenses</p>
    </div>
  </div>
<% }); %>

</div>

<%- include("partials/footer"); -%>
